<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TradeProBuddy - Interactive Project Dashboard</title>
  <meta name="color-scheme" content="dark light" />
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <link rel="stylesheet" href="tradepro_dashboard_v048.css" />
</head>

<body>
  <div id="gate" aria-modal="true" role="dialog">
    <div class="gate-card">
      <div class="top">
        <h2>TradeProBuddy Dashboard</h2>
        <p><span class="dot"></span> Protected view</p>
      </div>
      <div class="mid">
        <label for="gateCode">Enter passcode</label>
        <div class="gate-row">
          <input id="gateCode" type="password" autocomplete="current-password" placeholder="Passcode" />
          <button id="gateBtn" class="btn primary" type="button">Unlock</button>
        </div>
        <div id="gateErr" class="err">Incorrect passcode. Try again.</div>
        <div class="hint">Tip: this is only front-end protection. For real security, serve behind authentication.</div>
      </div>
    </div>
  </div>

  <div class="wrap" id="app">
    <header>
      <div style="min-width: 0;">
        <h1 class="h-title">TradeProBuddy™ Project Dashboard</h1>
        <p class="h-sub">Server-backed view + editable data (saved to your server).<span class="build-version">• Build: V048</span></p>
        <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:12px">
          <span class="pill"><span class="dot"></span><b>Owner:</b> Emile (BrainIT Consulting)</span>
          <span class="pill" title="Stored as ISO UTC in status.json; displayed here in your local time zone."><b>Updated:</b> <span id="updatedAt">-</span></span>
            <span class="pill" id="savePill" title="Last successful server save / load"><span class="dot" id="saveDot"></span><b id="saveLabel">Server</b>: <span id="saveRev">rev -</span></span>
        </div>
      </div>
      <div class="brand-logo">
        <img src="https://img1.wsimg.com/isteam/ip/deac7fcc-497b-4e83-8280-f4ec9c3eb3ce/BrainITBrain1.png/:/rs=w:200,h:200,cg:true,m/cr=w:200,h:200/qt=q:95" alt="BrainIT Consulting logo" />
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:10px">
        <span class="badge"><span class="dot"></span><span id="overallBadge">-</span></span>
        <button class="btn small" type="button" id="btnAbout">How this works</button>
      </div>
    </header>

    <div class="toolbar" aria-label="Dashboard actions">
      <button class="btn primary" type="button" id="btnEditOverall">Edit Overall</button>
      <button class="btn" type="button" id="btnEditBranch">Edit a Branch</button>
      <button class="btn" type="button" id="btnNewBranch">New Branch</button>
      <button class="btn" type="button" id="btnServerSettings">Server Settings</button>
      <button class="btn" type="button" id="btnSyncServer">Save To Server</button>
      <button class="btn ghost" type="button" id="btnRefreshServer">Refresh from Server</button>
      <div class="dropdown" id="backupsDropdown">
        <button class="btn ghost" type="button" id="btnBackups" aria-haspopup="true" aria-expanded="false">Backups ⬇️</button>
        <div class="dropdown-menu" id="backupsMenu" role="menu">
          <button class="btn ghost small" type="button" id="btnDashboardBackup">Dashboard backup</button>
          <button class="btn ghost small" type="button" id="btnDashboardRestore">Restore/import</button>
        </div>
      </div>
    </div>
    <input id="dashboardImportFile" type="file" accept="application/json" style="display:none" />

    <div class="foot" id="howItWorks" style="display:none">
      <b>How this works:</b> This dashboard is <b>server-first</b>. Use <b>Refresh from Server</b> to pull the latest saved data from your server, make edits, then click <b>Save To Server</b>. Your <b>Server Settings</b> are stored locally and are never cleared by this dashboard.
    </div>

    <div class="grid">
      <section class="card" aria-labelledby="overallTitle">
        <div class="hd">
          <h2 id="overallTitle">Overall Status</h2>
          <span class="pill" id="overallSummaryPill" style="display:none"></span>
        </div>
        <div class="bd">
          <div class="kpis">
            <div class="kpi">
              <p class="label">Headline</p>
              <p class="value" id="overallHeadline">-</p>
            </div>
            <div class="kpi">
              <p class="label">Notes</p>
              <p class="value" style="font-size:1rem;font-weight:650" id="overallNotes">-</p>
            </div>
            <div class="kpi">
              <p class="label">Rolling Forward</p>
              <p class="value" id="overallBadge2">-</p>
              <p class="sub" style="margin-top:10px" id="overallProgress">Overall progress: -</p>
              <p class="sub" id="overallSummary">-</p>
            </div>
          </div>
        </div>
      </section>

      <section class="card" aria-labelledby="branchesTitle">
        <div class="hd">
          <h2 id="branchesTitle">Progress by Branch</h2>
          <span class="pill" id="localModePill">Mode: <b>Local</b></span>
        </div>
        <div class="bd">
          <div class="filters" id="branchFilters">
            <div class="field">
              <label for="filterSearch">Search</label>
              <input id="filterSearch" placeholder="Search branches, tags, owners" />
            </div>
            <div class="field">
              <label for="filterStatus">Status</label>
              <select id="filterStatus">
                <option value="">All</option>
                <option>Planned</option>
                <option>In Progress</option>
                <option>Active</option>
                <option>Paused</option>
                <option>In Development</option>
                <option>Blocked</option>
                <option>Done</option>
              </select>
            </div>
            <div class="field">
              <label for="filterPriority">Priority</label>
              <select id="filterPriority">
                <option value="">All</option>
                <option>Low</option>
                <option>Normal</option>
                <option>High</option>
                <option>Critical</option>
              </select>
            </div>
            <div class="field">
              <label for="filterOwner">Owner</label>
              <select id="filterOwner">
                <option value="">All</option>
              </select>
            </div>
            <div class="field">
              <label for="filterTag">Tag</label>
              <select id="filterTag">
                <option value="">All</option>
              </select>
            </div>
            <div class="filter-actions">
              <button class="btn ghost small" type="button" id="filterClear">Clear</button>
            </div>
          </div>

          <div class="chart-card" id="progressChartCard">
            <p class="chart-title">Progress Snapshot</p>
            <div id="progressChart"></div>
          </div>

          <div id="branches"></div>
        </div>
      </section>
    </div>

    <div class="foot">© 2025 BrainIT Consulting • TradeProBuddy™ Internal Dashboard</div>
  </div>

  <!-- MODALS -->
  <div class="overlay" id="ovOverall" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mh">
        <div>
          <h3>Edit Overall</h3>
          <p>Saves locally. Use Save To Server to persist.</p>
        </div>
        <button class="x" type="button" data-close="ovOverall">x</button>
      </div>
      <div class="mb">
      <div class="form two">
          <div>
            <label for="oBadge">Badge</label>
            <input id="oBadge" />
          </div>
          <div>
            <label for="oUpdatedAt">Updated At (ISO)</label>
            <input id="oUpdatedAt" />
          </div>
          <div style="grid-column:1/-1">
            <label for="oHeadline">Headline</label>
            <input id="oHeadline" />
          </div>
          <div style="grid-column:1/-1">
            <label for="oNotes">Notes</label>
            <textarea id="oNotes"></textarea>
          </div>
          <div style="grid-column:1/-1">
            <label for="oSummary">Optional Summary (right-card pill)</label>
            <input id="oSummary" />
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" type="button" id="saveOverall">Save</button>
        <button class="btn" type="button" data-close="ovOverall">Cancel</button>
      </div>
    </div>
  </div>

  <div class="overlay" id="ovBranch" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mh">
        <div>
          <h3>Edit Branch</h3>
          <p>Edit status / progress / checkpoints. Use one item per line.</p>
        </div>
        <button class="x" type="button" data-close="ovBranch">x</button>
      </div>
      <div class="mb">
        <div class="form two">
          <div>
            <label for="bKey">Branch</label>
            <select id="bKey"></select>
          </div>
          <div>
            <label for="bRename">Rename to</label>
            <input id="bRename" placeholder="Leave blank to keep current" />
            <div class="help">Letters/numbers plus dashes and underscores only.</div>
          </div>
          <div>
            <label for="bStatus">Status</label>
            <select id="bStatus">
              <option>Planned</option>
              <option>In Progress</option>
              <option>Active</option>
              <option>Paused</option>
              <option>In Development</option>
              <option>Blocked</option>
              <option>Done</option>
            </select>
          </div>
          <div>
            <label for="bPriority">Priority</label>
            <select id="bPriority">
              <option>Low</option>
              <option>Normal</option>
              <option>High</option>
              <option>Critical</option>
            </select>
          </div>
          <div>
            <label for="bOwner">Owner</label>
            <input id="bOwner" placeholder="Owner name" />
          </div>
          <div>
            <label for="bDueDate">Due Date</label>
            <input id="bDueDate" type="date" />
          </div>
          <div style="grid-column:1/-1">
            <label for="bProgress">Progress (0-100)</label>
            <input id="bProgress" type="number" min="0" max="100" step="1" />
          </div>
          <div style="grid-column:1/-1">
            <label for="bTags">Tags (comma separated)</label>
            <input id="bTags" placeholder="ops, qa, crm" />
          </div>
          <div style="grid-column:1/-1">
            <label for="bCkpts">Checkpoints (one per line)</label>
            <div id="bCkptsList" class="cp-editor-list"></div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <input id="bCkptNew" placeholder="Add checkpoint" />
              <button class="btn small" type="button" id="bCkptAdd">Add</button>
            </div>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" type="button" id="saveBranch">Save</button>
        <button class="btn" type="button" data-close="ovBranch">Cancel</button>
      </div>
    </div>
  </div>
<div class="overlay" id="ovServer">
    <div class="modal">
      <div class="mh">
        <div>
          <h3>Server settings</h3>
          <p>Configure n8n webhook endpoints and API key.</p>
        </div>
        <button class="x" type="button" id="btnCloseServer">×</button>
      </div>

      <div class="mb">
        <div class="form two">
          <div style="grid-column:1/-1">
            <label for="svSaveUrl">Save URL (POST)</label>
            <input id="svSaveUrl" placeholder="https://YOUR-N8N/webhook/..." />
            <p class="hint">This is your n8n webhook URL for saving status.</p>
          </div>

          <div style="grid-column:1/-1">
            <label for="svReadUrl">Read URL (GET)</label>
            <input id="svReadUrl" placeholder="https://YOUR-N8N/webhook/read" />
            <p class="hint">Used by Refresh and auto-load to fetch the latest saved status.</p>
          </div>

          <div style="grid-column:1/-1">
            <label for="svApiKey">API key header (x-api-key)</label>
            <input id="svApiKey" placeholder="tpb_..." />
            <p class="hint">Must match your Header Auth credential in n8n.</p>
          </div>

          <div style="grid-column:1/-1">
            <label for="svUpdatedBy">Updated by</label>
            <input id="svUpdatedBy" placeholder="dashboard" />
            <p class="hint">Saved with each revision for auditing.</p>
          </div>
        </div>

        <div class="foot" style="margin-top:16px;padding:12px;background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.22);border-radius:12px">
          <b style="color:var(--accent)">Tip:</b> Click "Refresh from Server" after saving settings to test the connection.
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnCancelServer" type="button">Cancel</button>
        <button class="btn ghost" id="btnImportServerSettings" type="button">Import settings</button>
        <button class="btn ghost" id="btnBackupServerSettings" type="button">Backup settings</button>
        <button class="btn ghost" id="btnTestServerSettings" type="button">Test connection</button>
        <button class="btn primary" id="btnSaveServerSettings" type="button">Save settings</button>
      </div>
      <input id="svImportFile" type="file" accept="application/json" style="display:none" />
    </div>
  </div>



  <div class="overlay" id="ovBackupSettings" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mh">
        <div>
          <h3>Backup Server Settings</h3>
          <p>Download or copy a JSON backup of your server settings.</p>
        </div>
        <button class="x" type="button" data-close="ovBackupSettings">x</button>
      </div>
      <div class="mb">
        <div class="form">
          <div>
            <label for="backupSettingsText">Backup JSON</label>
            <textarea id="backupSettingsText" readonly style="min-height:220px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;"></textarea>
            <div class="help">If the download is blocked, copy this JSON and save it as a .json file.</div>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" type="button" id="btnBackupCopy">Copy JSON</button>
        <button class="btn primary" type="button" data-close="ovBackupSettings">Close</button>
      </div>
    </div>
  </div>

  <div class="overlay" id="ovDashboardBackup" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mh">
        <div>
          <h3>Dashboard Backup</h3>
          <p>Download or copy a JSON backup of your dashboard data (server settings excluded).</p>
        </div>
        <button class="x" type="button" data-close="ovDashboardBackup">x</button>
      </div>
      <div class="mb">
        <div class="form">
          <div>
            <label for="dashboardBackupText">Backup JSON</label>
            <textarea id="dashboardBackupText" readonly style="min-height:220px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;"></textarea>
            <div class="help">If the download is blocked, copy this JSON and save it as a .json file.</div>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" type="button" id="btnDashboardBackupCopy">Copy JSON</button>
        <button class="btn primary" type="button" data-close="ovDashboardBackup">Close</button>
      </div>
    </div>
  </div>

  <div class="overlay" id="ovDashboardRestoreConfirm" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mh">
        <div>
          <h3>Restore Dashboard Backup</h3>
          <p>This will replace your local dashboard data with the selected backup.</p>
        </div>
        <button class="x" type="button" data-close="ovDashboardRestoreConfirm">x</button>
      </div>
      <div class="mb">
        <div class="form">
          <div>
            <label>Restore summary</label>
            <div class="help" id="dashboardRestoreSummary">Backup details will appear here.</div>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" type="button" id="btnDashboardRestoreCancel">Cancel</button>
        <button class="btn primary" type="button" id="btnDashboardRestoreConfirm">Restore</button>
      </div>
    </div>
  </div>

  <!-- New Branch Overlay -->
  <div class="overlay" id="ovNewBranch" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <div>
          <div class="modalTitle">Create New Branch</div>
          <div class="modalSub">Adds a new branch card and saves locally. Use "Save To Server" to persist to n8n.</div>
        </div>
        <button class="iconBtn" type="button" id="nbClose" aria-label="Close">✕</button>
      </div>

      <div class="modalBody">
        <div class="grid2">
          <div class="field">
            <label>Branch Key (unique)</label>
            <input id="nbKey" placeholder="e.g. qa, hubspot, crm" />
            <div class="help">Letters/numbers plus dashes and underscores only.</div>
          </div>

          <div class="field">
            <label>Status</label>
            <select id="nbStatus">
              <option>Planned</option>
              <option>In Progress</option>
              <option>In Review</option>
              <option>Blocked</option>
              <option>Active</option>
              <option>Done</option>
            </select>
          </div>

          <div class="field">
            <label>Progress (0—100)</label>
            <input id="nbProgress" type="number" min="0" max="100" step="1" value="0" />
          </div>

          <div class="field" style="grid-column:1/-1;">
            <label>Checkpoints (one per line)</label>
            <textarea id="nbCheckpoints" rows="6" placeholder="First checkpoint&#10;Second checkpoint"></textarea>
          </div>
        </div>
      </div>

      <div class="modalFooter">
        <button class="btn ghost" type="button" id="nbCancel">Cancel</button>
        <button class="btn primary" type="button" id="nbCreate">Create Branch</button>
      </div>
    </div>
  </div>


<script src="tradepro_dashboard_v048.js"></script>

  <div id="loadingOverlay" style="display:none; position:fixed; inset:0; z-index:2000; align-items:center; justify-content:center; background:rgba(0,0,0,.55); backdrop-filter: blur(4px);">
    <div style="min-width:min(520px,92vw); max-width:720px; padding:18px 18px; border-radius:18px; background:rgba(16,22,32,.72); border:1px solid rgba(255,255,255,.10); box-shadow:0 20px 60px rgba(0,0,0,.55);">
      <div style="display:flex; align-items:center; gap:12px;">
        <div style="width:14px; height:14px; border-radius:999px; border:2px solid rgba(255,255,255,.35); border-top-color: rgba(76,175,80,.95); animation:spin 0.9s linear infinite;"></div>
        <div id="loadingText" style="font-weight:700; letter-spacing:.2px;">Loading…</div>
      </div>
      <div style="margin-top:8px; color:rgba(255,255,255,.70); font-size:13px;">If this takes longer than a few seconds, check your Read URL and API key.</div>
    </div>
  </div>

</body>
</html>













