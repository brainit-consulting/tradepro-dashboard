<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TradeProBuddy ‚Äî Project Dashboard</title>
  <style>
    :root{
      --bg:#070a12;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.075);
      --line:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#aab3c2;
      --brand:#7B3FA0;
      --mint:#34D399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius:18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(1100px 520px at 20% -10%, rgba(123,63,160,.24), transparent 60%),
        radial-gradient(900px 520px at 90% 0%, rgba(52,211,153,.12), transparent 55%),
        radial-gradient(700px 420px at 50% 110%, rgba(59,130,246,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:26px 18px 70px}

    /* -------------------------------------------------------
       Gate overlay (keep exactly)
    ------------------------------------------------------- */
    #gateOverlay{
      position:fixed; inset:0; z-index:9999;
      display:flex; align-items:center; justify-content:center;
      padding:36px 16px;
      background:
        radial-gradient(circle at top, rgba(15,23,42,.95), rgba(2,6,23,.98) 55%, rgba(0,0,0,.98) 100%);
      backdrop-filter:saturate(180%) blur(4px);
    }
    .gateCard{
      width:min(520px, 94vw);
      background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid rgba(148,163,184,.22);
      border-radius:22px;
      box-shadow: var(--shadow);
      padding:22px 20px 18px;
    }
    .gateTop{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom:10px;
    }
    .gateBadge{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(123,63,160,.12);
      border:1px solid rgba(123,63,160,.25);
      color:#e9d5ff;
      font-weight:700;
      letter-spacing:.2px;
    }
    .gateHint{
      font-size:.92rem;
      color:rgba(226,232,240,.78);
      text-align:right;
      line-height:1.25;
    }
    .gateTitle{
      font-size:1.15rem;
      margin:8px 0 6px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .gateSub{
      margin:0 0 14px;
      color:rgba(226,232,240,.78);
      font-size:.98rem;
      line-height:1.4;
    }
    .gateRow{
      display:flex; gap:10px; align-items:center;
    }
    .gateInput{
      flex:1;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.28);
      background:rgba(2,6,23,.45);
      color:var(--text);
      outline:none;
      font-size:1rem;
    }
    .gateBtn{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(52,211,153,.30);
      background:linear-gradient(135deg, rgba(52,211,153,.20), rgba(123,63,160,.12));
      color:#dcfce7;
      font-weight:800;
      cursor:pointer;
      white-space:nowrap;
    }
    .gateErr{
      margin:10px 2px 0;
      font-size:.92rem;
      color:#fecaca;
      display:none;
    }

    /* -------------------------------------------------------
       Header / layout
    ------------------------------------------------------- */
    header{
      display:flex; align-items:flex-start; justify-content:space-between; gap:18px;
      padding:10px 2px 18px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:46px;height:46px;border-radius:14px;
      background:linear-gradient(135deg, rgba(123,63,160,.85), rgba(52,211,153,.65));
      box-shadow:0 14px 40px rgba(123,63,160,.25);
    }
    .brand h1{
      margin:0;
      font-size:1.35rem;
      letter-spacing:.2px;
      font-weight:900;
    }
    .brand p{
      margin:2px 0 0;
      color:rgba(226,232,240,.74);
      font-size:.96rem;
      line-height:1.25;
    }
    .meta{
      text-align:right;
      color:rgba(226,232,240,.68);
      font-size:.92rem;
      line-height:1.2;
    }
    .meta strong{color:rgba(226,232,240,.92)}

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
      margin-top:8px;
    }
    @media (max-width: 960px){
      .grid{grid-template-columns:1fr}
      .meta{text-align:left}
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid rgba(148,163,184,.16);
      border-radius: var(--radius);
      box-shadow: 0 18px 60px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .card .hd{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px 16px 12px;
      background:linear-gradient(90deg, rgba(123,63,160,.12), rgba(52,211,153,.06));
      border-bottom:1px solid rgba(148,163,184,.14);
    }
    .card .hd h2{
      margin:0;
      font-size:1.05rem;
      font-weight:900;
      letter-spacing:.2px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      font-weight:800;
      font-size:.84rem;
      color:#e2e8f0;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(2,6,23,.35);
      white-space:nowrap;
    }
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.ok{background:var(--mint); box-shadow:0 0 0 4px rgba(52,211,153,.12)}
    .dot.ip{background:var(--warn); box-shadow:0 0 0 4px rgba(251,191,36,.12)}
    .dot.bad{background:var(--bad); box-shadow:0 0 0 4px rgba(251,113,133,.14)}
    .bd{padding:14px 16px 16px}

    .small{
      color:rgba(226,232,240,.72);
      font-size:.95rem;
      line-height:1.45;
      margin:0;
    }
    .kpis{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
      margin-top:12px;
    }
    @media (max-width: 560px){ .kpis{grid-template-columns:1fr} }
    .kpi{
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.16);
      background:rgba(2,6,23,.36);
    }
    .kpi .lbl{color:rgba(226,232,240,.68); font-size:.82rem; margin-bottom:6px}
    .kpi .val{font-weight:900; font-size:1.05rem}
    .kpi .sub{color:rgba(226,232,240,.70); font-size:.86rem; margin-top:4px}

    /* -------------------------------------------------------
       Progress table
    ------------------------------------------------------- */
    table{width:100%; border-collapse:separate; border-spacing:0 10px}
    th{
      text-align:left;
      font-size:.82rem;
      color:rgba(226,232,240,.70);
      padding:0 10px 6px;
      letter-spacing:.18px;
      font-weight:800;
    }
    td{
      padding:12px 10px;
      background:rgba(2,6,23,.34);
      border-top:1px solid rgba(148,163,184,.14);
      border-bottom:1px solid rgba(148,163,184,.10);
    }
    tr td:first-child{
      border-left:1px solid rgba(148,163,184,.12);
      border-radius:14px 0 0 14px;
    }
    tr td:last-child{
      border-right:1px solid rgba(148,163,184,.12);
      border-radius:0 14px 14px 0;
    }
    .rowTitle{font-weight:900}
    .rowSub{color:rgba(226,232,240,.66); font-size:.84rem; margin-top:2px}
    .statusTag{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(2,6,23,.35);
      font-weight:900;
      font-size:.84rem;
      white-space:nowrap;
    }
    .progress-shell{
      height:10px;
      border-radius:999px;
      background:rgba(148,163,184,.14);
      overflow:hidden;
      border:1px solid rgba(148,163,184,.12);
    }
    .progress-bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(52,211,153,.85), rgba(123,63,160,.75));
      box-shadow:0 10px 26px rgba(123,63,160,.18);
      transition:width .45s ease;
    }
    .progress-label{
      text-align:right;
      color:rgba(226,232,240,.72);
      font-size:.82rem;
      font-weight:900;
      margin-top:6px;
    }

    /* -------------------------------------------------------
       Section links
    ------------------------------------------------------- */
    .links{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
      margin-top:10px;
    }
    @media (max-width: 640px){ .links{grid-template-columns:1fr} }
    .linkCard{
      padding:13px 12px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.16);
      background:rgba(2,6,23,.36);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .linkCard .t{font-weight:900}
    .linkCard .s{color:rgba(226,232,240,.66); font-size:.86rem; margin-top:3px}
    .chev{opacity:.7}
    .linkCard:hover{border-color: rgba(52,211,153,.28); transform: translateY(-1px)}
    .linkCard{transition: all .18s ease}

    /* -------------------------------------------------------
       Detail cards
    ------------------------------------------------------- */
    .section{
      margin-top:16px;
    }
    .section h3{
      margin:0 0 8px;
      font-size:1rem;
      font-weight:900;
      letter-spacing:.2px;
    }
    .section p{margin:0;color:rgba(226,232,240,.74); line-height:1.45}
    .checklist{
      margin:10px 0 0;
      padding:0;
      list-style:none;
      display:grid;
      gap:9px;
    }
    .checklist li{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.14);
      background:rgba(2,6,23,.30);
      color:rgba(226,232,240,.84);
    }
    .check{
      width:18px;height:18px; margin-top:1px;
      border-radius:6px;
      border:1px solid rgba(52,211,153,.35);
      background:rgba(52,211,153,.14);
      flex:0 0 auto;
    }
    .note{
      color:rgba(226,232,240,.70);
      font-size:.9rem;
      margin-top:10px;
      padding:12px 12px;
      border-radius:16px;
      border:1px dashed rgba(148,163,184,.20);
      background:rgba(2,6,23,.28);
    }

    footer{
      margin-top:20px;
      color:rgba(226,232,240,.55);
      font-size:.86rem;
      text-align:center;
    }
  </style>
</head>

<body>
  <!-- Gate overlay -->
  <div id="gateOverlay">
    <div class="gateCard" role="dialog" aria-modal="true" aria-labelledby="gateTitle">
      <div class="gateTop">
        <div class="gateBadge">
          <span>üîí</span>
          <span>TradeProBuddy Dashboard</span>
        </div>
        <div class="gateHint">
          Protected view<br><strong>Enter passcode</strong>
        </div>
      </div>
      <div id="gateTitle" class="gateTitle">Access Required</div>
      <p class="gateSub">This dashboard is private. Enter the passcode to view progress, links, and current status.</p>
      <div class="gateRow">
        <input id="gateInput" class="gateInput" type="password" placeholder="Passcode‚Ä¶" autocomplete="current-password" />
        <button id="gateBtn" class="gateBtn">Unlock</button>
      </div>
      <div id="gateErr" class="gateErr">Incorrect passcode. Try again.</div>
    </div>
  </div>

  <div class="wrap" id="app" style="display:none;">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>TradeProBuddy‚Ñ¢ Project Dashboard</h1>
          <p>One place for status, progress, and next steps across all branches.</p>
        </div>
      </div>
      <div class="meta">
        <div><strong>Owner:</strong> Emile (BrainIT Consulting)</div>
        <div><strong>Updated:</strong> <span id="updatedDate" data-updated>‚Äî</span></div>
      </div>
    </header>

    <div class="grid">
      <!-- Left: Overall -->
      <div class="card">
        <div class="hd">
          <h2>Overall Status</h2>
          <div class="pill">
            <span class="dot ip" data-overall-dot></span>
            <span data-overall-badge>In Progress</span>
          </div>
        </div>
        <div class="bd">
          <p class="small" data-overall-notes>
            Core routing + subflows are live. Electrical branch is now sending emails end-to-end.
            Roofing email nodes have been hardened against empty/invalid recipients. Next: apply the same hardening approach to Plumbing and centralize email sending.
          </p>

          <div class="kpis">
            <div class="kpi">
              <div class="lbl">Current Focus</div>
              <div class="val" data-kpi-focus>Multi-trade resiliency</div>
              <div class="sub" data-kpi-focus-sub>Email safety + shared send subflow</div>
            </div>
            <div class="kpi">
              <div class="lbl">Most Recent Win</div>
              <div class="val" data-kpi-win>Electrical branch ‚úÖ</div>
              <div class="sub" data-kpi-win-sub>Gmail send succeeded end-to-end</div>
            </div>
            <div class="kpi">
              <div class="lbl">Next Risk to Remove</div>
              <div class="val" data-kpi-risk>Empty ‚ÄúTo‚Äù fields</div>
              <div class="sub" data-kpi-risk-sub>Guard + normalize once</div>
            </div>
          </div>

          <div class="section">
            <h3>Quick Links</h3>
            <div class="links">
              <a class="linkCard" href="#n8n">
                <div>
                  <div class="t">n8n Workflows</div>
                  <div class="s">Root router + trade subflows</div>
                </div>
                <div class="chev">‚Ä∫</div>
              </a>
              <a class="linkCard" href="#jotform">
                <div>
                  <div class="t">Forms & Apps</div>
                  <div class="s">Survey capture + embedded apps</div>
                </div>
                <div class="chev">‚Ä∫</div>
              </a>
              <a class="linkCard" href="#reports">
                <div>
                  <div class="t">Reports</div>
                  <div class="s">HTML outputs + internal views</div>
                </div>
                <div class="chev">‚Ä∫</div>
              </a>
              <a class="linkCard" href="#website">
                <div>
                  <div class="t">Website</div>
                  <div class="s">Landing + demo routes</div>
                </div>
                <div class="chev">‚Ä∫</div>
              </a>
              <a class="linkCard" href="#architecture">
                <div>
                  <div class="t">Architecture</div>
                  <div class="s">Conventions + reuse plan</div>
                </div>
                <div class="chev">‚Ä∫</div>
              </a>
              <a class="linkCard" href="https://brainitconsulting.com/" target="_blank" rel="noopener">
                <div>
                  <div class="t">BrainIT Consulting</div>
                  <div class="s">Main site</div>
                </div>
                <div class="chev">‚Üó</div>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: Progress -->
      <div class="card">
        <div class="hd">
          <h2>Progress by Branch</h2>
          <div class="pill">
            <span class="dot ip" data-branch-summary-dot></span>
            <span data-branch-summary>Rolling Forward</span>
          </div>
        </div>
        <div class="bd">
          <table aria-label="Project progress table">
            <thead>
              <tr>
                <th>Area</th>
                <th>Status</th>
                <th style="width:46%;">Progress</th>
              </tr>
            </thead>
            <tbody>
              <tr data-branch-row="n8n">
                <td>
                  <div class="rowTitle">n8n</div>
                  <div class="rowSub">Routing + subflows + Gmail</div>
                </td>
                <td>
                  <span class="statusTag" data-status><span class="dot ok"></span>Active</span>
                </td>
                <td>
                  <div class="progress-shell">
                    <div class="progress-bar" data-progress-fill style="width:80%;"></div>
                  </div>
                  <div class="progress-label" data-progress-pct>80%</div>
                </td>
              </tr>

              <tr data-branch-row="forms">
                <td>
                  <div class="rowTitle">Forms &amp; Apps</div>
                  <div class="rowSub">Survey capture + app embeds</div>
                </td>
                <td>
                  <span class="statusTag" data-status><span class="dot ip"></span>In Progress</span>
                </td>
                <td>
                  <div class="progress-shell">
                    <div class="progress-bar" data-progress-fill style="width:55%;"></div>
                  </div>
                  <div class="progress-label" data-progress-pct>55%</div>
                </td>
              </tr>

              <tr data-branch-row="reports">
                <td>
                  <div class="rowTitle">Reports</div>
                  <div class="rowSub">HTML outputs + internal dashboards</div>
                </td>
                <td>
                  <span class="statusTag" data-status><span class="dot ok"></span>Active</span>
                </td>
                <td>
                  <div class="progress-shell">
                    <div class="progress-bar" data-progress-fill style="width:85%;"></div>
                  </div>
                  <div class="progress-label" data-progress-pct>85%</div>
                </td>
              </tr>

              <tr data-branch-row="website">
                <td>
                  <div class="rowTitle">Website</div>
                  <div class="rowSub">Demo pages + CTA routing</div>
                </td>
                <td>
                  <span class="statusTag" data-status><span class="dot ip"></span>In Progress</span>
                </td>
                <td>
                  <div class="progress-shell">
                    <div class="progress-bar" data-progress-fill style="width:45%;"></div>
                  </div>
                  <div class="progress-label" data-progress-pct>45%</div>
                </td>
              </tr>

              <tr data-branch-row="architecture">
                <td>
                  <div class="rowTitle">Architecture</div>
                  <div class="rowSub">Shared subflows + hardening</div>
                </td>
                <td>
                  <span class="statusTag" data-status><span class="dot ip"></span>Planned</span>
                </td>
                <td>
                  <div class="progress-shell">
                    <div class="progress-bar" data-progress-fill style="width:40%;"></div>
                  </div>
                  <div class="progress-label" data-progress-pct>40%</div>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="note">
            <strong>Note:</strong> Progress is weighted toward production stability (routing, emails, and guardrails), not just feature count.
          </div>
        </div>
      </div>
    </div>

    <!-- Detail sections -->
    <div class="grid" style="margin-top:18px;">
      <div class="card section" id="n8n">
        <div class="hd">
          <h2>n8n Workflows</h2>
          <div class="pill" data-detail-pill="n8n"><span class="dot ok" data-detail-dot="n8n"></span><span data-detail-text="n8n">Active</span></div>
        </div>
        <div class="bd">
          <p class="small">
            Root router dispatches to trade-specific subflows. Each trade handles its own AI estimate + polishing + messaging.
          </p>

          <div class="section">
            <h3>Current Checkpoints</h3>
            <ul class="checklist" data-checklist="n8n">
              <li>Global router ‚Üí subflows handoff confirmed (roofing, plumbing, electrical)</li>
              <li>Electrical branch: end-to-end test run succeeded (AI output ‚Üí Gmail send)</li>
              <li>Email To/Reply-To hardening added to prevent empty/invalid addresses from failing runs</li>
              <li>Contractor Profiles HTML Report (V7) wired and branded (TradeProBuddy‚Ñ¢)</li>
              <li>Multi-trade contractor records (roofing + plumbing + electrical) live in DB</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="card section" id="jotform">
        <div class="hd">
          <h2>Forms &amp; Apps</h2>
          <div class="pill" data-detail-pill="forms"><span class="dot ip" data-detail-dot="forms"></span><span data-detail-text="forms">In Progress</span></div>
        </div>
        <div class="bd">
          <p class="small">
            Each trade uses a survey-style form/app to capture job details. Data posts to the root workflow, which routes to the trade subflow.
          </p>

          <div class="section">
            <h3>Current Checkpoints</h3>
            <ul class="checklist" data-checklist="forms">
              <li>Roofer survey form V1.6.x integrated with core n8n workflow</li>
              <li>Electrician form fields and flow drafted (USA-only) and mapped to the Electrical subflow</li>
              <li>Plumber form branch created; hardening for email fields in progress</li>
              <li>App embed + demo pages working for Trade Pros entry points</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:18px;">
      <div class="card section" id="reports">
        <div class="hd">
          <h2>Reports</h2>
          <div class="pill" data-detail-pill="reports"><span class="dot ok" data-detail-dot="reports"></span><span data-detail-text="reports">Active</span></div>
        </div>
        <div class="bd">
          <p class="small">
            Reports include customer-facing drafts and internal tables. Goal: fast, readable, branded outputs.
          </p>

          <div class="section">
            <h3>Current Checkpoints</h3>
            <ul class="checklist" data-checklist="reports">
              <li>Contractor / Homeowner / Adjuster HTML outputs implemented for roofing</li>
              <li>Electrical estimate drafts polished by Style Expert and successfully emailed (end-to-end)</li>
              <li>Sortable Contractor Profiles HTML Report (V7) live for internal use</li>
              <li>Status + progress dashboard page in place (this page)</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="card section" id="website">
        <div class="hd">
          <h2>Website</h2>
          <div class="pill" data-detail-pill="website"><span class="dot ip" data-detail-dot="website"></span><span data-detail-text="website">In Progress</span></div>
        </div>
        <div class="bd">
          <p class="small">
            Demo pages live under BrainIT Consulting, with password-gated previews and embedded apps.
          </p>

          <div class="section">
            <h3>Current Checkpoints</h3>
            <ul class="checklist" data-checklist="website">
              <li>Trade Pros landing page routes to Roofing / Electrical / Plumbing demos</li>
              <li>Roofers demo page live (app + password gate + report modal baseline preserved)</li>
              <li>Electrical demo page live and sending emails successfully</li>
              <li>Copy updates: roofer-friendly messaging, branded ‚ÄúAbout This App‚Äù block, and disclaimers</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="card section" id="architecture" style="margin-top:18px;">
      <div class="hd">
        <h2>Architecture</h2>
        <div class="pill" data-detail-pill="architecture"><span class="dot ip" data-detail-dot="architecture"></span><span data-detail-text="architecture">Planned</span></div>
      </div>
      <div class="bd">
        <p class="small">
          Keep the system modular: root router ‚Üí subflows per trade. Reuse common blocks (email, normalization, logging) as shared subflows.
        </p>

        <div class="section">
          <h3>Conventions</h3>
          <ul class="checklist" data-checklist="architecture">
            <li><span class="check"></span><div><strong>Single source of truth</strong> for key fields (company, owner, homeowner, adjuster)</div></li>
            <li><span class="check"></span><div><strong>Normalize once</strong> (trim/dedupe/validate emails) before any send step</div></li>
            <li><span class="check"></span><div><strong>Fail soft</strong>: log + continue when optional downstream actions fail</div></li>
            <li><span class="check"></span><div><strong>Reusable email</strong> node/subflow for every trade branch</div></li>
          </ul>
        </div>

        <div class="section">
          <h3>Hardening Backlog (Next)</h3>
          <ul class="checklist">
            <li><strong>Pre-Gmail guard node</strong>: validate recipients + log + continue (avoid workflow failure)</li>
            <li><strong>Shared ‚ÄúSend Safe Email‚Äù subflow</strong> reused by all trades</li>
            <li><strong>Centralized email normalization</strong>: trim, dedupe, validate once (To/CC/BCC/Reply-To)</li>
          </ul>
        </div>
      </div>
    </div>

    <footer>
      ¬© 2025 BrainIT Consulting ‚Ä¢ TradeProBuddy‚Ñ¢ Internal Dashboard
    </footer>
  </div>

  <script>
  // ---------------------------------------------------------
  // Auto status loader (reads status.json and updates UI)
  // NOTE: "Updated:" (top-right) is hard-coded to local time for now.
  // ---------------------------------------------------------

  function formatLocalStamp(d){
    try{
      return d.toLocaleString(undefined, {
        year:"numeric", month:"short", day:"2-digit",
        hour:"2-digit", minute:"2-digit"
      });
    }catch(e){
      return String(d);
    }
  }

  function setHardcodedUpdatedNow(){
    const el = document.querySelector('[data-updated]');
    if(el) el.textContent = formatLocalStamp(new Date());
  }

  async function fetchStatusJson(){
    const url = 'https://brainit-consulting.github.io/tradepro-dashboard/status.json?ts=' + Date.now();
    try{
      const res = await fetch(url, { cache: 'no-store' });
      if(!res.ok) throw new Error('status fetch failed: ' + res.status);
      return await res.json();
    }catch(err){
      console.warn('[dashboard] status not loaded', err);
      return null;
    }
  }

  function setText(sel, txt){
    const el = document.querySelector(sel);
    if(el) el.textContent = (txt ?? '');
  }

  function setDotClass(dotEl, status){
    if(!dotEl) return;
    dotEl.classList.remove('ok','ip','bad');
    const s = String(status || '').toLowerCase();
    if(s.includes('active') || s.includes('done') || s.includes('success')) dotEl.classList.add('ok');
    else if(s.includes('blocked') || s.includes('fail') || s.includes('error')) dotEl.classList.add('bad');
    else dotEl.classList.add('ip');
  }

  function setBranchRow(branchKey, statusText, progress){
    const row = document.querySelector(`[data-branch-row="${branchKey}"]`);
    if(!row) return;

    const statusEl = row.querySelector('[data-status]');
    const dotEl = statusEl ? statusEl.querySelector('.dot') : null;
    const fillEl = row.querySelector('[data-progress-fill]');
    const pctEl  = row.querySelector('[data-progress-pct]');

    if(statusEl){
      // keep the existing dot element if present
      const dot = statusEl.querySelector('.dot');
      statusEl.textContent = '';
      if(dot) statusEl.appendChild(dot);
      statusEl.appendChild(document.createTextNode(' ' + (statusText ?? '')));
    }

    if(dotEl) setDotClass(dotEl, statusText);

    const pct = Math.max(0, Math.min(100, Number(progress || 0)));
    if(fillEl) fillEl.style.width = pct + '%';
    if(pctEl) pctEl.textContent = pct + '%';
  }


  function setDetailStatus(branchKey, statusText){
    const txtEl = document.querySelector(`[data-detail-text="${branchKey}"]`);
    const dotEl = document.querySelector(`[data-detail-dot="${branchKey}"]`);
    if(txtEl) txtEl.textContent = (statusText ?? '');
    if(dotEl) setDotClass(dotEl, statusText);
  }

  function setChecklist(branchKey, items){
    const ul = document.querySelector(`[data-checklist="${branchKey}"]`);
    if(!ul || !Array.isArray(items)) return;
    ul.innerHTML = '';
    for(const raw of items){
      const t = (typeof raw === 'string') ? raw.trim() : '';
      if(!t) continue;
      const li = document.createElement('li');
      li.textContent = t;
      ul.appendChild(li);
    }
  }

  async function initAutoStatus(){
    // hard-code the header timestamp for now
    setHardcodedUpdatedNow();

    const status = await fetchStatusJson();
    if(!status) return;

    // Overall badge + note
    if(status.overall?.badge){
      setText('[data-overall-badge]', status.overall.badge);
      setDotClass(document.querySelector('[data-overall-dot]'), status.overall.badge);
    }
    if(status.overall?.notes){
      setText('[data-overall-notes]', status.overall.notes);
    }

    // Optional KPI overrides
    if(status.overall?.kpis?.focus?.title) setText('[data-kpi-focus]', status.overall.kpis.focus.title);
    if(status.overall?.kpis?.focus?.sub)   setText('[data-kpi-focus-sub]', status.overall.kpis.focus.sub);

    if(status.overall?.kpis?.win?.title)   setText('[data-kpi-win]', status.overall.kpis.win.title);
    if(status.overall?.kpis?.win?.sub)     setText('[data-kpi-win-sub]', status.overall.kpis.win.sub);

    if(status.overall?.kpis?.risk?.title)  setText('[data-kpi-risk]', status.overall.kpis.risk.title);
    if(status.overall?.kpis?.risk?.sub)    setText('[data-kpi-risk-sub]', status.overall.kpis.risk.sub);

    // Branch rows
    const b = status.branches || {};
    setBranchRow('n8n',          b.n8n?.status,          b.n8n?.progress);
    setBranchRow('forms',        b.forms?.status,        b.forms?.progress);
    setBranchRow('reports',      b.reports?.status,      b.reports?.progress);
    setBranchRow('website',      b.website?.status,      b.website?.progress);
    setBranchRow('architecture', b.architecture?.status, b.architecture?.progress);

    // Detail card pills + checklists (optional)
    setDetailStatus('n8n',          b.n8n?.status);
    setDetailStatus('forms',        b.forms?.status);
    setDetailStatus('reports',      b.reports?.status);
    setDetailStatus('website',      b.website?.status);
    setDetailStatus('architecture', b.architecture?.status);

    setChecklist('n8n',          b.n8n?.checkpoints || b.n8n?.currentCheckpoints);
    setChecklist('forms',        b.forms?.checkpoints || b.forms?.currentCheckpoints);
    setChecklist('reports',      b.reports?.checkpoints || b.reports?.currentCheckpoints);
    setChecklist('website',      b.website?.checkpoints || b.website?.currentCheckpoints);
    setChecklist('architecture', b.architecture?.checkpoints || b.architecture?.currentCheckpoints);

    // Right-card summary (optional)
    if(status.overall?.summary){
      setText('[data-branch-summary]', status.overall.summary);
      setDotClass(document.querySelector('[data-branch-summary-dot]'), status.overall.summary);
    }
  }

  // expose so the gate script can call it
  window.initAutoStatus = initAutoStatus;

  // set the hard-coded stamp immediately on page load
  document.addEventListener('DOMContentLoaded', () => {
    setHardcodedUpdatedNow();
  });
</script>

  <script>
  // keep password + behavior exactly
  (function(){
    const PASSWORD = "tradeprobuddy";
    const gateOverlay = document.getElementById("gateOverlay");
    const app = document.getElementById("app");
    const input = document.getElementById("gateInput");
    const btn = document.getElementById("gateBtn");
    const err = document.getElementById("gateErr");

    function unlock(){
      const v = String(input.value || "").trim();
      if (v === PASSWORD){
        gateOverlay.style.display = "none";
        app.style.display = "block";
        try{ localStorage.setItem("tpb_dash_ok","1"); }catch(e){}
        try{ window.initAutoStatus && window.initAutoStatus(); }catch(e){}
      }else{
        err.style.display = "block";
        input.focus();
        input.select();
      }
    }

    btn.addEventListener("click", unlock);
    input.addEventListener("keydown", (e)=>{ if (e.key === "Enter") unlock(); });

    try{
      if (localStorage.getItem("tpb_dash_ok") === "1"){
        gateOverlay.style.display = "none";
        app.style.display = "block";
        try{ window.initAutoStatus && window.initAutoStatus(); }catch(e){}
      }else{
        input.focus();
      }
    }catch(e){
      input.focus();
    }
  })();
</script>

</body>
</html>
