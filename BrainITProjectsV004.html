<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>TradeProBuddy™ Project Dashboard v004</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#05060a;color:#e5e7eb}
button{cursor:pointer}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:20px}
.card{background:rgba(255,255,255,0.04);border-radius:16px;padding:16px;margin:16px}
.header{padding:20px;font-size:22px;font-weight:600}
.badge{padding:4px 10px;border-radius:999px;background:#1f2937}
.hidden{display:none}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center}
.modal-card{background:#0b1220;padding:20px;border-radius:16px;width:min(500px,90vw)}
input,textarea{width:100%;background:#020617;color:#e5e7eb;border:1px solid #1f2937;border-radius:8px;padding:10px}
</style>
</head>
<body>

<div class="header">
  TradeProBuddy™ Project Dashboard <span class="badge">v004</span>
</div>

<div class="toolbar">
  <button id="btnAddNote">＋ Add Note</button>
  <button id="btnRefresh">⟳ Refresh</button>
  <button id="btnServer">⚙ Server Settings</button>
  <span id="saveState" class="badge">Idle</span>
</div>

<div class="card">
  <h3>Project Notes</h3>
  <div id="notes"></div>
</div>

<div id="noteModal" class="modal hidden">
  <div class="modal-card">
    <h3>Add Note</h3>
    <textarea id="noteText" rows="4" placeholder="Enter note..."></textarea>
    <div style="margin-top:10px;display:flex;gap:10px;justify-content:flex-end">
      <button onclick="closeNote()">Cancel</button>
      <button onclick="saveNote()">Save</button>
    </div>
  </div>
</div>

<script>
const CFG={
  projectId:"tradeprobuddy",
  apiKey:"tpb_7f4b9c2e8d1a4c0b9e6c3f1a9d2e7b4c",
  readUrl:"https://n8n.srv1060663.hstgr.cloud/webhook/BrainIT-GET-dashboard-data",
  writeUrl:"https://n8n.srv1060663.hstgr.cloud/webhook/BrainIT-POST-dashboard-data"
};
let state=null;
function setSaveState(t){document.getElementById("saveState").innerText=t}
async function loadFromServer(){
  setSaveState("Loading...");
  const r=await fetch(`${CFG.readUrl}?projectId=${CFG.projectId}`,{headers:{"x-api-key":CFG.apiKey}});
  const j=await r.json();
  state=j.doc;
  render();
  setSaveState("Loaded");
}
function render(){
  const n=document.getElementById("notes");n.innerHTML="";
  (state.notes||[]).forEach(x=>{const d=document.createElement("div");d.className="card";d.textContent=x.text;n.appendChild(d);});
}
async function post(op,payload){
  setSaveState("Saving...");
  await fetch(CFG.writeUrl,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":CFG.apiKey},
  body:JSON.stringify({projectId:CFG.projectId,rev:state.meta.rev,op,payload,updatedBy:"dashboard",status:state.meta.statusLabel||"Active Dev"})});
  await loadFromServer();setSaveState("Saved");
}
function openNote(){document.getElementById("noteModal").classList.remove("hidden")}
function closeNote(){document.getElementById("noteModal").classList.add("hidden")}
async function saveNote(){const t=document.getElementById("noteText").value.trim();if(!t)return;document.getElementById("noteText").value="";closeNote();await post("note.create",{text:t});}
document.getElementById("btnAddNote").onclick=openNote;
document.getElementById("btnRefresh").onclick=loadFromServer;
loadFromServer();
</script>

</body>
</html>